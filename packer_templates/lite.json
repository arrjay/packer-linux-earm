{
	"variables": {
	},
	"builders": [
		{
			"name": "pi",
			"type": "arm-image",
			"image_type": "raspberrypi",
			"iso_url": "./2020-05-27-raspios-buster-lite-armhf.zip",
			"iso_checksum_type": "sha256",
			"iso_checksum": "f5786604be4b41e292c5b3c711e2efa64b25a5b51869ea8313d58da0b46afc64",
			"output_filename": "images/lite/pi.img"
		},
		{
			"name": "sheeva",
			"type": "arm-image",
			"image_mounts": [ "/boot", "/" ],
			"iso_url": "./images/upstream/sheevaplug-s1.img",
			"iso_checksum_type": "none",
			"output_filename": "images/lite/sheeva.img"
		}
	],
	"provisioners": [
		{
			"only": [ "pi" ],
			"type": "shell",
			"environment_vars": [ "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" ],
			"execute_command": "/bin/chmod +x {{ .Path }}; {{ .Vars }} {{ .Path }}",
			"inline": [
                                "mv /etc/ld.so.preload /etc/ld.so.preload.dist"
                        ]
		},
		{
			"only": [ "sheeva" ],
			"type": "shell",
			"environment_vars": [ "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", "TZ=UCT",
						"DEBIAN_FRONTEND=noninteractive", "LANG=C" ],
			"execute_command": "/bin/chmod +x {{ .Path }}; {{ .Vars }} {{ .Path }}",
			"inline": [
				"chmod 0755 /",
				"chown 0:0 /",
				"/debootstrap/debootstrap --second-stage --merged-usr",
				"# set root password to nosoup4u (sheevaplug image default)",
				"usermod -p '$6$fFo1kfYxV7aTJbir$LpccRu/YSjF/7Ih2NOBhmlcZumM3lhQsbvUXIdkwyuzTVJdTgf5rlOKRRUwUwyqwFxCHQV1Tsio1El0jWNbea.' root"
			]
		},
		{
			"type": "shell",
			"environment_vars": [ "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" ],
			"execute_command": "/bin/chmod +x {{ .Path }}; {{ .Vars }} {{ .Path }}",
			"inline": [
				"mkdir /tmp/packer-files"
			]
		},
		{
			"type": "file",
			"source": "files/lite/",
			"destination": "/tmp/packer-files"
		},
		{
			"type": "shell",
			"environment_vars": [ "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" ],
			"execute_command": "/bin/chmod +x {{ .Path }}; {{ .Vars }} {{ .Path }}",
			"scripts": [
				"./scripts/lite/0_init.sh"
			]
		}
	]
}
