{
	"variables": {
	},
	"builders": [
		{
			"name": "pi",
			"type": "arm-image",
			"image_type": "raspberrypi",
			"iso_url": "./images/netdata/pi.img",
			"iso_checksum_type": "none",
			"output_filename": "images/standard/pi.img",
			"target_image_size": 4294967296
		},
		{
			"name": "sheeva",
			"type": "arm-image",
			"image_mounts": [ "/boot", "/boot/IMD", "/" ],
			"iso_url": "./images/netdata/sheeva.img",
			"iso_checksum_type": "none",
			"output_filename": "images/standard/sheeva.img",
			"target_image_size": 3221225472
		}
	],
	"provisioners": [
                {
                        "type": "shell-local",
                        "execute_command": ["bash", "-c", "{{ .Vars }} {{ .Script }}"],
                        "inline": [
				"p=$(pwd) && rm -f $p/files/standard/cache/imd/install.run && pushd vendor/imd && make OUTPUTDIR=$p/files/standard/cache/imd/ && popd",
				"mkdir -p $p/files/standard/cache/etc/skel",
				"cp vendor/dotfiles/bashrc $p/files/standard/cache/etc/skel/.bashrc",
				"cp -R vendor/dotfiles/bash.d $p/files/standard/cache/etc/skel/.bash.d"
			]
                },
		{
			"type": "shell",
			"environment_vars": [ "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" ],
			"execute_command": "/bin/chmod +x {{ .Path }}; {{ .Vars }} {{ .Path }}",
			"inline": [
				"mkdir -p /tmp/packer-files"
			]
		},
		{
			"type": "file",
			"source": "files/standard/",
			"destination": "/tmp/packer-files"
		},
		{
			"type": "shell",
			"environment_vars": [
				"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
				"TZ=UCT",
				"XT_CGROUP_DKMS_VERSION=0.1",
				"UPSTREAM_KVER=4.19.132"
			],
			"execute_command": "/bin/chmod +x {{ .Path }}; {{ .Vars }} {{ .Path }}",
			"scripts": [
				"./scripts/standard/0_init.sh",
				"./scripts/standard/packages.sh",
				"./scripts/standard/xt_cgroup.sh",
				"./scripts/standard/rescue-initrd.sh",
				"./scripts/standard/install-dterm.sh",
				"./scripts/standard/ssm.sh",
				"./scripts/standard/ups.sh",
				"./scripts/standard/login-config.sh"
			]
		},
		{
			"type": "shell",
			"environment_vars": [ "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", "TZ=UCT" ],
			"execute_command": "/bin/chmod +x {{ .Path }}; {{ .Vars }} {{ .Path }}",
			"inline": [
				"rm -rf /tmp/packer-files",
				"df -m"
                        ]
		}
	]
}
