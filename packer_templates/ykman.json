{
    "variables": {},
    "builders": [
        {
            "name": "pi",
            "type": "arm-image",
            "image_type": "raspberrypi",
            "iso_url": "./images/xfce/pi.img.xz",
            "iso_checksum": "none",
            "output_filename": "./images/ykman/pi.img",
            "target_image_size": 5046586368
        }
    ],
    "provisioners": [
        {
            "type": "shell-local",
            "execute_command": [
                "bash",
                "-c",
                "{{ .Vars }} {{ .Script }}"
            ],
            "inline": [
                "p=\"$(pwd)\"",
                "mkdir -p \"${p}/files/ykman/cache\"",
                "(cd \"${p}/vendor/misc-scripts\" && git archive HEAD -o \"${p}/files/ykman/cache/misc-scripts.tar\")"
            ]
        },
		{
			"type": "shell",
			"environment_vars": [ "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" ],
			"execute_command": "/bin/chmod +x {{ .Path }}; {{ .Vars }} {{ .Path }}",
			"inline": [
				"mkdir -p /tmp/packer-files"
			]
		},
		{
			"type": "file",
			"source": "files/ykman/",
			"destination": "/tmp/packer-files"
		},
        {
			"type": "shell",
			"environment_vars": [ "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", "TZ=UCT" ],
			"execute_command": "/bin/chmod +x {{ .Path }}; {{ .Vars }} {{ .Path }}",
			"scripts": [
				"./scripts/ykman/0_init.sh"
			]
		}
    ]
}